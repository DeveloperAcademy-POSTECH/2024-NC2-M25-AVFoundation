# 2024-NC2-M25-AVFoundation

## ğŸ¥ Youtube Link
(ì¶”í›„ ë§Œë“¤ì–´ì§„ ìœ íŠœë¸Œ ë§í¬ ì¶”ê°€)

## ğŸ’¡ About AVFoundation
### ì‹œì²­ê° ë¯¸ë””ì–´(ìŒì›ì´ë‚˜ ì˜ìƒ)ë¥¼ ì¬ìƒ ë° ìƒì„± í•´ì£¼ëŠ” í”„ë ˆì„ì›Œí¬

- ì¹´ë©”ë¼ì™€ ë§ˆì´í¬ë¥¼ í†µí•´ ì˜¤ë””ì˜¤ ë° ë¹„ë””ì˜¤ ìº¡ì³
- ì˜¤ë””ì˜¤ ë° ë¹„ë””ì˜¤ ì¬ìƒ
- ë¯¸ë””ì–´ í¸ì§‘
- ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° í”„ë¡œí† ì½œ ì§€ì›
- ë©”íƒ€ ë°ì´í„° ì²˜ë¦¬

## ğŸ¯ What we focus on?
AVFoundation: ì¬ìƒ ì¤‘ì¸ ìŒì›ì˜ ì‹œê°„ ëŒ€ì— ë§ˆì»¤ë¥¼ ì¶”ê°€í•˜ê³  ì›í•˜ëŠ” ì‹œê°„ëŒ€ë¡œ ë°”ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆê²Œ í•œë‹¤.  
MediaPlayer: ìŒì› ì¬ìƒì€ ì¼ë°˜ì ìœ¼ë¡œ ë°±ê·¸ë¼ìš´ë“œì—ì„œë„ ì¬ìƒì´ ê¸°ëŒ€ë˜ë¯€ë¡œ ë°±ê·¸ë¼ìš´ë“œ ì œì–´ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.  


## ğŸ’¼ Use Case
> ì¶¤ ì—°ìŠµ í•  ë•Œ, ë‚´ê°€ ì›í•˜ëŠ” ì‹œê°„ëŒ€ë¡œ ë²„íŠ¼ í•œ ë²ˆì— ë°”ë¡œ ê°€ì!

## ğŸ–¼ï¸ Prototype
<details>
  <summary>ìŒì› ë¶ˆëŸ¬ì˜¤ê¸°, ì¬ìƒ, ì¼ì‹œì •ì§€</summary>
  <br>
  <img width="200" alt="image" src="https://github.com/DeveloperAcademy-POSTECH/2024-NC2-M25-AVFoundation/assets/82072195/f4cd6a81-02ec-4da8-aa9f-dea9f21da29a">  
  
  + (ì„ì‹œ ìŒì› íŒŒì¼ ìì²´ ë‚´ì¥)  
  + ìŒì› ë¶ˆëŸ¬ì˜¤ê¸°  
    - ìŒì› ë¶ˆëŸ¬ì˜¤ê¸° ì „ì—ëŠ” ìŒì› ì œì–´ ê¸°ëŠ¥(ë§ˆì»¤ ì„¤ì •, ì¬ìƒ-ì •ì§€, ë°°ì†, 5ì´ˆ ì•ë’¤ë¡œê°€ê¸°) ë¹„í™œì„±í™”
    - ë©”íƒ€ ë°ì´í„°(ì•¨ë²” ì»¤ë²„, ìŒì› íƒ€ì´í‹€, ìŒì› ì•„í‹°ìŠ¤íŠ¸)
</details>

<details>
  <summary>5ì´ˆ ì•, ë’¤ë¡œ ê°€ê¸°</summary>
  <br>
  <img width="200" alt="image" src="https://github.com/DeveloperAcademy-POSTECH/2024-NC2-M25-AVFoundation/assets/82072195/0dd6d42e-5417-47ab-8eb6-f74c48a3eedb">
  
  - ì¬ìƒ or ì •ì§€ ìƒíƒœì—ì„œ 5ì´ˆ ì•, ë’¤ë¡œ ê°€ê¸° 
</details>

<details>
  <summary>ë°°ì†</summary>
  <br>
  <img width="200" alt="image" src="https://github.com/DeveloperAcademy-POSTECH/2024-NC2-M25-AVFoundation/assets/82072195/f4ed1b71-1b17-430d-8fc4-9967bc2585c2">
  
  - ì¬ìƒ or ì •ì§€ ìƒíƒœì—ì„œ ì ìš© ê°€ëŠ¥
  - 0.1ë°° ë¹„ìœ¨ ë‹¨ìœ„ë¡œ ìŒì›ì˜ ì†ë„ ì¡°ì ˆ ê°€ëŠ¥
  - ìŒì› ì†ë„ê°€ 1.0ì´ ì•„ë‹ë•Œ í•´ë‹¹ ë°°ì† í…ìŠ¤íŠ¸ë¥¼ ëˆ„ë¥´ë©´ 1.0 ë°°ì†ìœ¼ë¡œ ëŒì•„ì˜´
</details>

<details>
  <summary>ë§ˆì»¤</summary>
  <br>
  <img width="200" alt="image" src="https://github.com/DeveloperAcademy-POSTECH/2024-NC2-M25-AVFoundation/assets/82072195/599c372d-a85b-4b32-8768-aabc9a509df4">

  - ë§ˆì»¤ ìƒì„± ë° ì‚­ì œ
  - í•´ë‹¹ ë§ˆì»¤ë¡œ ë°”ë¡œ ì´ë™
</details>

<details>
  <summary>ë°±ê·¸ë¼ìš´ë“œ ì¬ìƒ</summary>
  <br>
  <img width="200" alt="image" src="https://github.com/DeveloperAcademy-POSTECH/2024-NC2-M25-AVFoundation/assets/82072195/72ee63dd-1bce-40c3-8d7a-c2376ac94dda">
  
  - ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¬ìƒ, ì •ì§€, 5ì´ˆ ì•, ë’¤ë¡œ ê°€ê¸° ê°€ëŠ¥
  - ì•¨ë²” ì»¤ë²„, ìŒì› íƒ€ì´í‹€, ìŒì› ì•„í‹°ìŠ¤íŠ¸ í‘œê¸°
</details>

## ğŸ› ï¸ About Code
<details>
  <summary>ì˜¤ë””ì˜¤ ê°ì²´ ìƒì„±</summary>
  
  ```swift 
  @State var audioPlayer: AVAudioPlayer!
  ```
</details>

<details>
  <summary>ìŒì› ë¶ˆëŸ¬ì˜¤ê¸° ë° ì œì–´</summary>

  ### ìŒì› ë¶ˆëŸ¬ì˜¤ê¸°
    
  ```swift 
  private func initAudioPlayer()
  ```

  ```swift 
  guard let path = Bundle.main.path(forResource: "Supernova.mp3", ofType: nil) else {
            print("File not found")
            return
        }
  ```

  ### ìƒíƒœ ì„¤ì •

  ```swift 
  do {
            try AVAudioSession.sharedInstance().setCategory(.playback, mode: .default, options: [])
            try AVAudioSession.sharedInstance().setActive(true)

            self.audioPlayer = try AVAudioPlayer(contentsOf: URL(fileURLWithPath: path))
            self.audioPlayer.prepareToPlay()
            self.audioPlayer.enableRate = true

            extractMetadata(from: path)

            formattedDuration = formatter.string(from: TimeInterval(self.audioPlayer.duration))!
            duration = self.audioPlayer.duration

            Timer.scheduledTimer(withTimeInterval: 0.1, repeats: true) { _ in
                if !self.audioPlayer.isPlaying {
                    self.isPlaying = false
                }

                if !self.isDragging {
                    self.currentTime = self.audioPlayer.currentTime
                    self.progress = CGFloat(self.audioPlayer.currentTime / self.audioPlayer.duration)
                    self.formattedProgress = formatter.string(from: TimeInterval(self.audioPlayer.currentTime))!
                }
            }

            setupControlCenterControls()
            remoteControlCenterInfo()
        }
  ```

</details>

<details>
  <summary>ì œì–´ì„¼í„° ë‚´ ë²„íŠ¼ êµ¬í˜„</summary>
  
```MPRemoteCommandCenter```

  ``` swift
  private func setupControlCenterControls() {
        let commandCenter = MPRemoteCommandCenter.shared()

        commandCenter.playCommand.addTarget { (commandEvent) -> MPRemoteCommandHandlerStatus in
            self.audioPlayer.play()
            return MPRemoteCommandHandlerStatus.success
        }

        commandCenter.pauseCommand.addTarget { (commandEvent) -> MPRemoteCommandHandlerStatus in
            self.audioPlayer.pause()
            return MPRemoteCommandHandlerStatus.success
        }

        commandCenter.skipBackwardCommand.addTarget { (commandEvent) -> MPRemoteCommandHandlerStatus in
            self.backward5Sec()
            return .success
        }

        commandCenter.skipForwardCommand.addTarget { (commandEvent) -> MPRemoteCommandHandlerStatus in
            self.forward5Sec()
            return .success
        }

        commandCenter.skipBackwardCommand.preferredIntervals = [5]
        commandCenter.skipForwardCommand.preferredIntervals = [5]
    }
  ```
  - MediaPlayerì˜ ```MPRemoteCommandCenter```ë¥¼ ì‚¬ìš©í•˜ì—¬ ì œì–´ì„¼í„°ì˜ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì–´ë–¤ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¬ê±´ì§€ ì§€ì •í•´ì¤ë‹ˆë‹¤.  
  ì¬ìƒ, ì •ì§€, 5ì´ˆ ì•ìœ¼ë¡œ, ë’¤ë¡œ ê°€ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.

</details>

<details>
  <summary>ì œì–´ì„¼í„° ë‚´ ìŒì› ì •ë³´ í‘œì‹œ</summary>

  ```MPNowPlayingInfoCenter```
  ``` swift
  private func remoteControlCenterInfo() {
        let nowPlayingInfoCenter = MPNowPlayingInfoCenter.default()
        var nowPlayingInfo = nowPlayingInfoCenter.nowPlayingInfo ?? [String: Any]()

        guard let path = Bundle.main.path(forResource: "Supernova", ofType: "mp3") else {
            print("Audio file not found")
            return
        }

        if let albumArtwork = albumArtwork {
            let artwork = MPMediaItemArtwork(boundsSize: albumArtwork.size, requestHandler: { size in
                return albumArtwork
            })
            nowPlayingInfo[MPMediaItemPropertyArtwork] = artwork
        }

        nowPlayingInfo[MPMediaItemPropertyTitle] = title
        nowPlayingInfo[MPMediaItemPropertyArtist] = artist
        nowPlayingInfo[MPMediaItemPropertyPlaybackDuration] = audioPlayer.duration
        nowPlayingInfo[MPNowPlayingInfoPropertyElapsedPlaybackTime] = audioPlayer.currentTime

        nowPlayingInfoCenter.nowPlayingInfo = nowPlayingInfo
    }
  ```
  - í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ë¯¸ë””ì–´ì˜ ì»¤ë²„ ì‚¬ì§„ì´ë‚˜ ë…¸ë˜ ì œëª©, ì•„í‹°ìŠ¤íŠ¸ì™€ ê°™ì€ ì •ë³´ë“¤ì„ ì œì–´ì„¼í„° ê°ì²´ì— ì´ˆê¸°í™” í•˜ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤.
</details>

<details>
  <summary>ë§ˆì»¤ ê¸°ëŠ¥</summary>
  
  ### ë§ˆì»¤ ì¶”ê°€í•˜ê¸° ë²„íŠ¼

  ```swift
  @State private var markers: [TimeInterval] = []
  ```

  - ```TimeInterval```ì„ ë§ˆì»¤ë°°ì—´ì— ì €ì¥í•©ë‹ˆë‹¤.

  ### ë§ˆì»¤ ë¦¬ìŠ¤íŠ¸

  ```swift
  private var markerListView: some View {
        ScrollView {
            VStack {
                ForEach(markers, id: \.self) { marker in
                    markerButton(marker: marker)
                        .padding(.horizontal)
                        .contextMenu {
                            markerContextMenu(marker: marker)
                        }
                }
            }
        }
        .disabled(audioPlayer == nil)
    }
  ```
  - ë“±ë¡í•œ ë§ˆì»¤ë¥¼ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.

  ### ë§ˆì»¤
 ```swift
private func markerButton(marker: TimeInterval) -> some View {
        Button(action: {
            self.audioPlayer.currentTime = marker
            self.progress = CGFloat(marker / self.duration)
            self.formattedProgress = self.formattedTime(marker)
            self.audioPlayer.play()
            self.isPlaying = true
        }) {
            Text("Marker at \(self.formattedTime(marker))")
                .padding()
                .frame(maxWidth: .infinity)
                .background(Color.blue)
                .foregroundColor(.white)
                .cornerRadius(12)
                .padding(.vertical, 2)
        }
    }
 ```
 - ìƒì„±ëœ ë§ˆì»¤ë¥¼ ëˆ„ë¥´ë©´ ìŒì›ì˜ í˜„ì¬ì‹œê°„ê³¼ í”„ë¡œê·¸ë˜ìŠ¤ ë°” ìœ„ì¹˜ë¥¼ ì—…ë°ì´íŠ¸ í•˜ì—¬ í•´ë‹¹ ì‹œê°„ìœ¼ë¡œ ì´ë™í•¨ê³¼ ë™ì‹œì— ì¬ìƒë©ë‹ˆë‹¤.

</details>